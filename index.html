<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lakshya</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --brand1: #ff7b00;
      --brand2: #0056b3;
      --ok: #28a745;
      --bg: #fefefe;
      --ink: #222;
      --card: #f4faff;
      --muted: #e9eef6;
    }
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: var(--bg); color: var(--ink); }
    header { text-align: center; padding: 2rem; background: linear-gradient(135deg, var(--brand1), var(--brand2)); color: white; }
    header h1 { margin: 0; font-size: 2.8rem; }
    header p { margin: 0.5rem 0; font-size: 1.2rem; }
    .cta-button { display: inline-block; margin-top: 1rem; padding: 0.75rem 1.5rem; background: var(--brand1); color: #fff; text-decoration: none; border-radius: 8px; font-weight: bold; transition: 0.25s; box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
    .cta-button:hover { background: var(--brand2); transform: translateY(-1px); }
    nav { position: sticky; top: 0; z-index: 50; display: flex; justify-content: center; gap: 1.5rem; background: var(--brand2); padding: 0.75rem 1rem; }
    nav a { color: white; text-decoration: none; font-weight: bold; }
    nav a:hover { color: var(--brand1); }
    section { padding: 2rem; max-width: 1100px; margin: auto; }
    section h2 { color: var(--brand2); display: flex; align-items: center; gap: 10px; }
    section h2 i { color: var(--brand1); }
    ul { list-style: none; padding: 0; }
    ul li { margin: 0.8rem 0; display: flex; align-items: center; gap: 10px; }
    ul li i { color: var(--brand1); font-size: 1.2rem; }
    form { display: flex; flex-direction: column; gap: 1.2rem; background: var(--card); padding: 2rem; border-radius: 12px; box-shadow: 0 3px 12px rgba(0,0,0,0.1); }
    form label { font-weight: bold; display: flex; align-items: center; gap: 8px; color: var(--brand2); }
    form input, form select, form textarea { padding: 0.8rem; border: 1px solid #ccd6e3; border-radius: 10px; width: 100%; background: #fff; }
    form button[disabled] { opacity: .7; cursor: not-allowed; }
    .metrics-grid { display: grid; grid-template-columns: repeat(3, minmax(220px,1fr)); gap: 1.25rem; margin-top: 1rem; }
    @media (max-width: 820px) { .metrics-grid { grid-template-columns: 1fr; } }
    .metric-card { background: var(--card); padding: 1.5rem; border-radius: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center; }
    .metric-card i { font-size: 2rem; margin-bottom: 0.5rem; }
    .impact-wrapper { width: 100%; background: #eef4ff; border-radius: 999px; overflow: hidden; height: 12px; }
    .impact-bar { height: 12px; width: 0%; background: linear-gradient(90deg, var(--brand1), var(--brand2)); animation: pulseStripe 1.4s linear infinite; }
    @keyframes pulseStripe { 0% { filter: brightness(1); } 50% { filter: brightness(1.25); } 100% { filter: brightness(1); } }
    .karma-spinner { width: 38px; height: 38px; border-radius: 50%; border: 4px solid transparent; border-top-color: var(--brand1); border-right-color: var(--brand2); border-bottom-color: var(--ok); animation: spin 1s linear infinite; margin: 0 auto; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .leaderboard { margin-top: 1rem; background: #fff; border: 1px solid #e6eef6; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.06); }
    .leaderboard-header { display: flex; align-items: center; justify-content: space-between; padding: 1rem 1.25rem; background: var(--card); }
    .leaderboard-list { padding: 0; margin: 0; }
    .leader-item { list-style: none; display: flex; align-items: center; justify-content: space-between; padding: 0.9rem 1.25rem; border-top: 1px solid #eef3f9; }
    .leader-left { display: flex; align-items: center; gap: .9rem; }
    .rank { width: 36px; height: 36px; border-radius: 50%; display: grid; place-items: center; font-weight: 700; color: #fff; background: var(--brand2); }
    .rank.gold { background: linear-gradient(135deg,#f7b733,#fc4a1a); }
    .rank.silver { background: linear-gradient(135deg,#bdc3c7,#2c3e50); }
    .rank.bronze { background: linear-gradient(135deg,#d1913c,#ffd194); }
    .user { font-weight: 600; }
    .score { font-weight: 700; color: var(--brand2); }
    .toast { position: fixed; left: 50%; transform: translateX(-50%); bottom: 24px; background: #111; color: #fff; padding: .8rem 1rem; border-radius: 999px; font-weight: 600; opacity: 0; pointer-events: none; transition: .25s; }
    .toast.show { opacity: 1; bottom: 32px; }
  </style>
</head>
<body>
  <header>
    <h1><i class="fas fa-handshake"></i> Lakshya</h1>
    <p>Gamified Civic Engagement Platform Powered by Microsoft Azure</p>
    <a href="#pledge" class="cta-button">Join the Movement</a>
  </header>

  <nav>
    <a href="#about">About</a>
    <a href="#why">Why</a>
    <a href="#features">Features</a>
    <a href="#impact">Impact</a>
    <a href="#azure">Azure AI</a>
    <a href="#dashboard">Sponsors</a>
    <a href="#liveMetrics">Metrics</a>
    <a href="#leaderboard">Leaderboard</a>
    <a href="#recentPledges">Community Wall</a>
    <a href="#pledge">Pledge</a>
    <a href="#contact">Contact</a>
  </nav>

  <!-- Sections: About, Why, Features, Impact, Azure, Metrics, Leaderboard, Recent Pledges, Pledge Form -->
  <!-- RECENT PLEDGES -->
  <section id="recentPledges">
    <h2><i class="fas fa-users"></i> Community Wall</h2>
    <ul id="recentList"></ul>
  </section>

  <!-- PLEDGE FORM -->
  <section id="pledge">
    <h2><i class="fas fa-pen-fancy"></i> Make Your Lakshya</h2>
    <form id="pledgeForm" novalidate>
      <label for="name"><i class="fas fa-user"></i> Your Name:</label>
      <input type="text" id="name" required placeholder="John Doe" />

      <label for="email"><i class="fas fa-envelope"></i> Email:</label>
      <input type="email" id="email" required placeholder="john@example.com" />

      <label for="mission"><i class="fas fa-bullseye"></i> Choose a Mission:</label>
      <select id="mission" required>
        <option value="">-- Select --</option>
        <option>Healthcare for All</option>
        <option>Education & Skilling</option>
        <option>Sustainability</option>
      </select>

      <label for="goal"><i class="fas fa-shoe-prints"></i> Your Goal:</label>
      <input type="text" id="goal" required minlength="5" placeholder="e.g., Walk 10,000 steps daily"/>

      <label for="reason"><i class="fas fa-comment-dots"></i> Why does this matter to you?</label>
      <textarea id="reason" rows="4" required placeholder="Share your motivation..."></textarea>

      <div class="impact-wrapper" aria-hidden="true">
        <div id="submitImpact" class="impact-bar"></div>
      </div>

      <button type="submit" id="submitBtn">Submit Pledge</button>
    </form>
  </section>

  <footer id="contact">
    <p>© 2025 Lakshya. All rights reserved.</p>
    <p>
      <a href="#"><i class="fab fa-facebook"></i></a>
      <a href="#"><i class="fab fa-twitter"></i></a>
      <a href="#"><i class="fab fa-instagram"></i></a>
      <a href="#"><i class="fab fa-linkedin"></i></a>
    </p>
  </footer>

  <button id="backToTop" title="Back to top"><i class="fas fa-arrow-up"></i></button>
  <div class="toast" id="toast">Pledge Submitted!</div>

  <script>
    const pledgeForm = document.getElementById('pledgeForm');
    const submitBtn = document.getElementById('submitBtn');
    const toast = document.getElementById('toast');
    const leaderList = document.getElementById('leaderList');
    const leaderSkeleton = document.getElementById('leaderSkeleton');
    const recentList = document.getElementById('recentList');

    const karmaPointsEl = document.getElementById('karmaPoints');
    const activeUsersEl = document.getElementById('activeUsers');
    const rewardsUnlockedEl = document.getElementById('rewardsUnlocked');
    const impactKarma = document.getElementById('impactKarma');
    const impactUsers = document.getElementById('impactUsers');
    const impactRewards = document.getElementById('impactRewards');
    const submitImpact = document.getElementById('submitImpact');

    const LB_API = 'https://lakshya-api.azurewebsites.net/api/leaderboard';
    const RECENT_API = 'https://lakshya-api.azurewebsites.net/api/recent';
    const PLEDGE_API = 'https://lakshya-api.azurewebsites.net/api/submit';
    const METRICS_API = 'https://lakshya-api.azurewebsites.net/api/metrics';

    function showToast(message){
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'),2500);
    }

    async function fetchLeaderboard(){
      try{
        const res = await fetch(LB_API);
        const data = await res.json();
        leaderSkeleton?.remove();
        leaderList.innerHTML = '';
        data.sort((a,b)=>b.karma-a.karma).forEach((user,i)=>{
          const li = document.createElement('li');
          li.className='leader-item';
          li.innerHTML = `
            <div class="leader-left">
              <div class="rank ${i===0?'gold':i===1?'silver':i===2?'bronze':''}">${i+1}</div>
              <div class="user">${user.name}</div>
            </div>
            <div class="score">${user.karma}</div>
          `;
          leaderList.appendChild(li);
        });
      }catch(err){
        console.error(err);
        document.getElementById('lbStatus').textContent='Failed to load';
      }
    }

    async function fetchRecent(){
      try{
        const res = await fetch(RECENT_API);
        const data = await res.json();
        recentList.innerHTML='';
        data.slice(0,10).forEach(pledge=>{
          const li=document.createElement('li');
          li.innerHTML = `<strong>${pledge.name}</strong> pledged <em>${pledge.goal}</em> for <strong>${pledge.mission}</strong> (${pledge.karma} Karma Points)`;
          recentList.appendChild(li);
        });
      }catch(err){console.error(err);}
    }

    async function fetchMetrics(){
      try{
        const res = await fetch(METRICS_API);
        const {karmaPoints,activeUsers,rewards} = await res.json();
        karmaPointsEl.textContent=karmaPoints;
        activeUsersEl.textContent=activeUsers;
        rewardsUnlockedEl.textContent=rewards;

        impactKarma.style.width = Math.min(100,karmaPoints/1000*100)+'%';
        impactUsers.style.width = Math.min(100,activeUsers/500*100)+'%';
        impactRewards.style.width = Math.min(100,rewards/200*100)+'%';
      }catch(err){console.error(err);}
    }

    pledgeForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      submitBtn.disabled=true;
      submitImpact.style.width = '0%';
      const data = {
        name:document.getElementById('name').value,
        email:document.getElementById('email').value,
        mission:document.getElementById('mission').value,
        goal:document.getElementById('goal').value,
        reason:document.getElementById('reason').value
      };
      try{
        const res = await fetch(PLEDGE_API,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(data)
        });
        if(res.ok){
          showToast('✅ Pledge Submitted!');
          pledgeForm.reset();
          submitImpact.style.width = '100%';
          fetchLeaderboard();
          fetchRecent();
          fetchMetrics();
        }else{
          showToast('❌ Submission failed!');
        }
      }catch(err){
        console.error(err);
        showToast('⚠️ Submission error!');
      } finally{
        submitBtn.disabled=false;
        setTimeout(()=>submitImpact.style.width='0%', 2000);
      }
    });

    document.getElementById('backToTop').addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));

    fetchLeaderboard();
    fetchRecent();
    fetchMetrics();
    setInterval(fetchMetrics,30000);
  </script>
</body>
</html>
